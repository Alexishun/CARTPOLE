clc;clear all;close all
syms q1 q2 dq1 dq2 t v k
x=[q1;q2;dq1;dq2];
dx=cartpole(t,x,v);
%%
Ici=1889592.67e-9;
m=100.17e-3;
T=1/2*(Ici)*dq2^2+m*9.81*cos(q2);
Td=0.9827;
dT=simplify(jacobian(T,x)*dx);
v=solve(dT+k*(T-Td),v)

function dxdt=cartpole(t,x,v)
    q1=x(1);q2=x(2);dq1=x(3);dq2=x(4);
    dxdt=[x(3);
        x(4);
        v;
        (1181881658614763861726131989216691521343721488541822732181367160832*sin(q2) - 17198428283327607274509829145945677599079642693632000000000000000*v*cos(q2)^3 - 168716581459443831884831139394980483654394473618736322697523960832*cos(q2)^2*sin(q2) + 120477233294063600465880973449726822676655209709568000000000000000*v*cos(q2) + 4834993649008463454101261255127*dq2^2*cos(q2)^3*sin(q2) + 173800605733921194060306554460155186016575029248*dq2^2*cos(q2)*sin(q2))/(4834993649008463454101261255127*cos(q2)^4 - 2683912230588215952650100820129724545400048194052214898706402700*cos(q2)^2 + 18801155234564507153627081328351192313378778031657501540061544448)];
end